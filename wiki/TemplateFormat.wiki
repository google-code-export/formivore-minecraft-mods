=The Template Format=
==Overview==
The Great Wall Mod and the Walled City Generator use the .tml (template) format adapted from d00dv4d3r’s ruins mod to define the look of walls and buildings. The format combines both variables the control parts of structures that are automatically generated and a block by block grid schematic. Template files can be edited in any text editor.
Each template file has three sections, for variables, block rules, and layers. This guide describes each of these sections.
Variables – control things like width, frequency, and material of parts of structures that are automatically generated.
Block Rules – Lists of blocks that can be generated in layers.
Layers – A block by block grid used to generate custom buildings and wall cross sections.
Also the customization section of the F.A.Q. answers some common questions regarding things you can do with the template files.
===How The Mods Use Template Files===
Both the Walled City Mod and the Great Wall Mod are designed around walls; in this case walls can mean either great walls, the outer walls of a city, or the (zero height) streets inside a city. Walls will generate buildings alongside, these can be either the default procedurally generated towers or building templates. The mods use template files for two purposes that are somewhat different but similar enough that I decided to maintain them in a single format:
Wall Templates – Here the template variables define the wall and the default towers built alongside the wall. The layers specify cross sections of the wall which are repeated for as long as the wall runs.
Building Templates – Here the layers specify the full 3D schematic of custom buildings that can be built alongside walls.
==File Locations==
All template directories are in the located in the resources folder. All templates are loaded when minecraft launches.
===File Locations - Great Wall Mod===
  * Wall Templates: /resources/greatwall
  * Building Templates: /resources /greatwall/buildings
===File Locations – Walled City Mod===
  * Outer Wall Templates: resources/walledcity
  * Outer Wall Building Templates: resources/walledcity/buildings
  * Street Templates: resources/walledcity/streets
  * Street Building Templates: resources/walledcity/streets

==Converting to the Template Format==
A script is available that can convert MCEdit schematics to templates files: Schematic to template converter



=Block Rules=  
(Note – this sections adapted from d00dv4d3r's Ruins Mod)
Rules are lists of blocks that are used to populate layers, the flexibility of allowing more than one type of block in a given location allows for a “ruined” look, mottled textures, and more variable designs.
Each rule must be formatted carefully, the format is:
rule<number>=<condition>,<chance to appear>,<list of blocks>

rule<number>
The mod does not care what you call these and will number the rules in the order they are loaded (sequentially from 1), so long as the line starts with "rule".  I suggest using "rule#" as a mnemonic, such as "rule1", "rule2", "rule12", etc...  Once the templates are loaded, the first rule in the list becomes rule #1 for the purposes of building a layer, the second becomes rule #2, and so on.
The mod uses a special rule, 0, which defines the Air block with a 100% spawn rate and no conditional.  You can use this rule in the layers to "blank out" certain areas (providing space for mobs, for instance).
<condition>
A conditional to the block being placed, aside from randomness.
0 - The block always attempts to spawn.
1 - There must be a block below it to attempt to spawn.
2 - There must be an adjacent block at the same level for a spawn attempt.
3 - There must be a block above this one in order for it to attempt to spawn.
5 – Choose and fix the blocktype for this rule once per template.

Adjacent in this case is not diagonal, only along the cardinal directions.
Adjacent blocks are processed after 0 and 1 conditionals have been placed, and "under blocks" are processed after all other blocks have been placed. Please note that these blocks are still processed in an order dependent on the rotation of the site.  For a normal, north-facing site, the block rules are processed for each line from the left and from the bottom template to the top.
<chance to appear>
The chance that this block will appear, out of 100, depending on whether the condition above is met.

<list of blocks>
A comma-delimited set of minecraft blockIDs.  This will determine what block will actually spawn in the location.  Each blockID is given the same weight, so you can skew the odds of a certain blockID appearing by adding it multiple times.  You can specify block metadata by adding a "-<metadata>" after the blockID.  For instance, to place a cobblestone stairs block ascending to the east, use 67-3.  To place a wood half-block (slab), use 44-2.

Special blockIDs – These are block IDs that instead of creating the correspondingly numbered block in the world, tell the mod to make certain things that can’t be coded by a single block ID. These include mob spawners, chests with different loot, and steps/stairs.
    300 = Leave existing world block alone
    301 = Mob Spawner (Zombie)
    302 = Mob Spawner (Skeleton) 
    303 = Mob Spawner (Spider)
    304 = Mob Spawner (Creeper)
    305 = Mob Spawner (Zombie, Skeleton, Creeper)
    306 = Mob Spawner (Easy, zombies and skeletons)
    307 = Mob Spawner (Medium, zombies, skeletons, and spiders)
    308 = Mob Spawner (Hard, all mobs)
    309 = Easy Chest (For Easy rewards)
    310 = Medium Chest (For Medium rewards)
    311 = Hard Chest (For Hard rewards)
    312 = Tower Chest;
    313 = Mob Spawner (Pig Zombie);
    314 = Mob Spawner (Enderman);
    315 = Mob Spawner (Cave Spider);
    316 = Mob Spawner (Ghast);
    319 = Compact/Half Stair – For wall templates. This will build either nothing, a half step, or a compact step depending on how the z-level of the wall is changing. Takes the same meta values as half-step blocks and will choose a matching compact step.

Rule Examples
Example 1, this spawns either air, cobblestone, or a mossy cobblestone 100% of the time:
rule1=0,100,0,4,48

Example 2, this spawns a mossy cobblestone 50% of the time but only if another block is underneath it:
rule1=1,50,48

Example 3, this spawns either a wood slab or a plank block, but only if there is an adjacent block on the same level:
rule1=2,100,44-2,5

Example 4, this spawns a torch standing on the ground:
rule1=0,100,50-5

Example 5, this spawns a Medium Chest (see special blockID above) 25% of the time:
rule1=0,25,310

=Layers=
Layers are where you actually provide the layout of the template. Each layer is a comma-delimited grid, with each block in the grid containing a rule. If you want the block blanked out use 0, which represents the Air-block rule. Each layer must have "layer" before the rule grid and terminate with "endlayer".
Example 1, a layer:
layer
0,1,0
1,1,1
2,2,2
endlayer

How the layers are laid out depends on what the template used for. There are two types:

==Standard Layout=
This is the layout used for templates in the ruins mod and is used for building templates in the Walled City and Great Wall mods. Here each layer represents a horizontal slice and there are as many layers as the height. In each layer, there are as many rows as the length and as many columns as the width. To orient directional blocks like stairs, the orientation of layers in the text file is as North pointing towards the top of the file. When templates are built alongside a wall, the building will be rotated so that North will become the direction pointing away from the wall, and South face will be touching the wall.
        
==Wall Cross Section Layout==
This layout is used for wall templates. Here each layer represents a vertical slice. During wall generation layers are used in order and repeated from the beginning once the last layer is reached. In each layer there as many rows as the wall height and as many columns as the wall width. The default orientation of a layer is that the top of the grid corresponds to up, and left of the grid corresponds to west. The default direction the wall will be propagated, and hence the order of the layers is south to north. The wall cross-section layout can be thought of as the standard layout flipped over onto its southern face.
 
       
==Named Layers==
Named layers are not part of a layout, but are rather used for special purposes by the code. Named layers are distinguished by a label after the "layer" tag, separated by a colon. E.g.
Example 2, named layer:
layer:shifted_right
1,1,1,1,1
1,0,0,0,1
endlayer


The following named layers are currently recognized:
layer:base
A horizontal slice used as a repeatable base. This layer is used to fill in air or water below the template until solid blocks are reached. Maximum number of layers that can be filled is given by the max_leveling variable. In the standard layout, the dimensions of the base layer should be the same as unnamed layers. In the cross-section layout there should only be one row; this row will be used as the base of each vertical unnamed slice.
 
layer:shifted
layer:shifted_right
layer:shifted_left
layer:shifted_up
layer:shifted_down
These named layers are used by wall templates to provide layers when a wall deviates from a straight line. For various reasons you may not want to use the unnamed layers in this case. If the specific layer:shifted_right, layer:shifted_left etc. are not given layer:shifted will be used. If layer:shifted is not given the first unnamed layer will be used.